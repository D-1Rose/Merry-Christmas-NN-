<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joyful Christmas Tree</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            /* ä¿®æ”¹ï¼šæ›´äº®çš„æ¸å˜èƒŒæ™¯ï¼Œè¥é€ èŠ‚æ—¥å¤œæ™šçš„é€šé€æ„Ÿ */
            background: radial-gradient(circle at center bottom, #882233 0%, #2a0a1a 40%, #050510 100%);
        }
        
        #ui-container {
            position: absolute; bottom: 20px; width: 100%; text-align: center; 
            pointer-events: none; z-index: 10;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        
        #greeting {
            font-size: 3em; 
            font-weight: bold;
            color: #fff;
            /* æ–‡å­—è¾‰å…‰å¢å¼º */
            text-shadow: 0 0 10px #ffaa00, 0 0 20px #ff6600, 0 0 30px #ff0000;
            pointer-events: auto;
            margin-bottom: 20px;
            animation: bounce 2s infinite ease-in-out;
        }
        
        #slider-container {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.25); /* èƒŒæ™¯æ›´äº®ä¸€ç‚¹ */
            padding: 15px 30px;
            border-radius: 50px;
            backdrop-filter: blur(8px);
            display: flex; align-items: center; gap: 15px;
            color: white; font-size: 1.1em; text-shadow: 0 1px 2px black;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        input[type=range] {
            width: 200px; cursor: pointer; accent-color: #ffaa00;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-size: 1.5em; pointer-events: none;
            text-shadow: 0 0 10px black;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/tween.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
</head>
<body>

    <div id="loading">æ­£åœ¨æŒ‚ä¸Šç…§ç‰‡ (5å¼ )... ğŸ“¸</div>

    <div id="ui-container">
        <div id="greeting" contenteditable="true">Merry Christmas! ğŸ„</div>
        
        <div id="slider-container">
            <span>ğŸ•¯ï¸ æ°›å›´</span>
            <input type="range" id="brightnessSlider" min="0.5" max="3.0" step="0.1" value="1.5">
            <span>â˜€ï¸ æ˜äº®</span>
        </div>
    </div>

    <script>
        // --- 1. é…ç½®åŒºåŸŸ ---
        // ä¿®æ”¹ï¼šæ”¯æŒ5å¼ å›¾ç‰‡ï¼Œæ–‡ä»¶åè¯·ç¡®ä¿æ˜¯ 1.jpg åˆ° 5.jpg (æˆ–è€… png)
        const imageFiles = ['./1.jpg', './2.jpg', './3.jpg', './4.jpg', './5.jpg']; 
        
        const EMOJIS = ['ğŸ', 'ğŸ¦Œ', 'ğŸ¬', 'ğŸ””', 'â„ï¸', 'â›„', 'ğŸ„', 'ğŸ§¸', 'ğŸª'];

        let scene, camera, renderer, composer, controls;
        let particleTree, lights = [];
        let bloomPass;
        
        // å…¨å±€å˜é‡å­˜å‚¨ç…§ç‰‡ç»„ï¼Œæ–¹ä¾¿åŠ¨ç”»
        window.photoCards = new THREE.Group();

        function init() {
            // åœºæ™¯
            scene = new THREE.Scene();
            // é›¾æ°”è°ƒå¾—æ›´é€äº®ï¼Œä¸å†æ˜¯é»‘è‰²é›¾
            scene.fog = new THREE.FogExp2(0x442233, 0.001); 

            // ç›¸æœº
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 60, 200);

            // æ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            // ä¿®æ”¹ï¼šç§»é™¤ ReinhardToneMappingï¼Œæ”¹ç”¨ Linearï¼Œè¿™æ ·æ›´äº®ï¼Œä¸ä¼šå‹æš—é«˜å…‰
            renderer.toneMapping = THREE.LinearToneMapping; 
            renderer.toneMappingExposure = 1.1; // é»˜è®¤æ›å…‰åº¦è°ƒé«˜
            document.body.appendChild(renderer.domElement);

            // æ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.8;
            controls.maxPolarAngle = Math.PI / 2 - 0.1;

            // --- 2. ç¯å…‰ç³»ç»Ÿ (å¤§å¹…å¢å¼º) ---
            const ambientLight = new THREE.AmbientLight(0xffeedd, 1.2); // å¼ºåº¦ç”± 0.6 æè‡³ 1.2
            scene.add(ambientLight);
            lights.push(ambientLight);

            // æ ¸å¿ƒä¸»å…‰æº
            const mainLight = new THREE.PointLight(0xffaa00, 2.5, 500); // å¼ºåº¦æè‡³ 2.5
            mainLight.position.set(0, 80, 20); // ç¨å¾®é å‰ä¸€ç‚¹ï¼Œç…§äº®ç…§ç‰‡
            scene.add(mainLight);
            lights.push(mainLight);

            // è¡¥å…‰ (ç…§äº®èƒŒé¢å’Œä¾§é¢)
            const fillLight = new THREE.DirectionalLight(0xccccff, 1.0);
            fillLight.position.set(0, 50, 200);
            scene.add(fillLight);
            lights.push(fillLight);

            // --- 3. åœ£è¯æ ‘ ---
            createFluffyTree();
            
            // --- 4. è£…é¥°å“ (Emoji å˜å¤§) ---
            addDecorations();

            // --- 5. ç…§ç‰‡ (5å¼  + åŸæ¯”ä¾‹) ---
            addFeaturedPhotos();
            scene.add(window.photoCards);

            // --- 6. åæœŸå¤„ç† (Bloom) ---
            const renderScene = new THREE.RenderPass(scene, camera);
            
            // è¾‰å…‰å‚æ•°å¾®è°ƒï¼Œè®©å®ƒäº®è€Œä¸ç³Š
            bloomPass = new THREE.UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight),
                1.0, 0.5, 0.7 
            );
            
            composer = new THREE.EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            // ç§»é™¤ Loading
            document.getElementById('loading').style.display = 'none';
            
            // --- 7. æ»‘å—é€»è¾‘ä¿®æ­£ (ç¡®ä¿æœ‰ç”¨) ---
            const slider = document.getElementById('brightnessSlider');
            slider.addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                
                // 1. è°ƒèŠ‚ç¯å…‰å¼ºåº¦
                mainLight.intensity = val * 1.5;
                ambientLight.intensity = val * 0.8;
                fillLight.intensity = val * 0.6;
                
                // 2. è°ƒèŠ‚æ•´ä½“æ›å…‰åº¦ (è¿™æ˜¯å˜äº®çš„å…³é”®)
                renderer.toneMappingExposure = val * 0.8;

                // 3. è°ƒèŠ‚è¾‰å…‰
                bloomPass.strength = val * 0.7;
            });
            
            // åˆå§‹åŒ–è§¦å‘ä¸€æ¬¡ï¼Œç¡®ä¿äº®åº¦å’Œæ»‘å—ä¸€è‡´
            slider.dispatchEvent(new Event('input'));

            animate();
        }

        // --- åˆ›å»ºæ¯›èŒ¸èŒ¸çš„ç²’å­æ ‘ ---
        function createFluffyTree() {
            const count = 3500; // å¢åŠ ç²’å­æ•°
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];

            const color1 = new THREE.Color(0x228b22); // æ£®æ—ç»¿
            const color2 = new THREE.Color(0x76ff03); // è§å…‰ç»¿ (æ›´äº®)

            for(let i=0; i<count; i++) {
                const y = Math.random() * 170;
                const progress = 1 - (y / 170);
                const radius = (15 + progress * 65) + (Math.random() - 0.5) * 15; 
                const angle = Math.random() * Math.PI * 2;

                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                
                positions.push(x, y, z);

                const color = Math.random() > 0.4 ? color1 : color2;
                colors.push(color.r, color.g, color.b);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            const spriteMap = createSoftParticleTexture();

            const material = new THREE.PointsMaterial({
                size: 4.0, // ç²’å­å˜å¤§
                map: spriteMap,
                vertexColors: true,
                transparent: true,
                opacity: 0.95, // ä¸é€æ˜åº¦å¢åŠ 
                depthWrite: false,
                blending: THREE.AdditiveBlending
            });

            particleTree = new THREE.Points(geometry, material);
            scene.add(particleTree);
        }

        // --- æ·»åŠ  Emoji è£…é¥° (å˜å¤§) ---
        function addDecorations() {
            const group = new THREE.Group();
            const count = 400; // æ•°é‡å¢åŠ 

            for (let i = 0; i < count; i++) {
                const emoji = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
                const map = createEmojiTexture(emoji);
                const material = new THREE.SpriteMaterial({ map: map, transparent: true });
                const sprite = new THREE.Sprite(material);

                const y = Math.random() * 160;
                const progress = 1 - (y / 160);
                const radius = (20 + progress * 60); 
                const angle = Math.random() * Math.PI * 2;

                sprite.position.set(
                    Math.cos(angle) * radius,
                    y + 5,
                    Math.sin(angle) * radius
                );
                
                // ä¿®æ”¹ï¼šå°ºå¯¸å˜å¤§ (åŸ 4-7 -> ç° 7-11)
                const scale = 7 + Math.random() * 4;
                sprite.scale.set(scale, scale, 1);
                
                sprite.userData = {
                    offset: Math.random() * 100,
                    speed: 0.02 + Math.random() * 0.02
                };

                group.add(sprite);
            }
            scene.add(group);
            window.decorations = group;
        }

        // --- æ·»åŠ  5 å¼ åŸæ¯”ä¾‹ç…§ç‰‡ ---
        function addFeaturedPhotos() {
            const loader = new THREE.TextureLoader();
            
            // 5ä¸ªå›ºå®šç‚¹ä½ (å‰å·¦, å‰å³, åå·¦, åå³, é¡¶ä¸­)
            // ç¡®ä¿ç…§ç‰‡åˆ†å¸ƒåœ¨æ ‘çš„å››å‘¨ï¼Œä¸ä¼šæŒ¤åœ¨ä¸€èµ·
            const configs = [
                { file: imageFiles[0], pos: [-40, 40, 40], rot: [0, Math.PI/4, 0] },
                { file: imageFiles[1], pos: [40, 40, 40], rot: [0, -Math.PI/4, 0] },
                { file: imageFiles[2], pos: [0, 90, 35], rot: [0, 0, 0] }, // ä¸­é—´åä¸Š
                { file: imageFiles[3], pos: [-35, 120, 0], rot: [0, 0, 0] }, // æ›´é«˜
                { file: imageFiles[4], pos: [35, 70, -35], rot: [0, Math.PI, 0] } // èƒŒé¢ä¸€å¼ 
            ];

            configs.forEach((cfg) => {
                // ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œè·å–å›¾ç‰‡å®½é«˜ï¼Œè®¡ç®—æ¯”ä¾‹
                loader.load(cfg.file, (tex) => {
                    const img = tex.image;
                    const aspect = img.width / img.height;
                    
                    // è®¾å®šåŸºå‡†å®½åº¦ï¼Œæ¯”å¦‚ 20
                    const baseWidth = 22;
                    const baseHeight = baseWidth / aspect;

                    // 1. ç…§ç‰‡ Mesh
                    const photoGeo = new THREE.PlaneGeometry(1, 1); // ä½¿ç”¨ 1x1 å‡ ä½•ä½“ï¼Œé  scale è°ƒæ•´
                    const photoMat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide });
                    const photo = new THREE.Mesh(photoGeo, photoMat);
                    photo.scale.set(baseWidth, baseHeight, 1);
                    photo.position.z = 0.1; // é˜²æ­¢é‡å 

                    // 2. è¾¹æ¡† (æ‹ç«‹å¾—é£æ ¼)
                    // è¾¹æ¡†æ¯”ç…§ç‰‡å®½ä¸€ç‚¹ï¼Œåº•éƒ¨ç•™å¤šä¸€ç‚¹ç©ºç™½
                    const borderGeo = new THREE.PlaneGeometry(1, 1);
                    const borderMat = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide });
                    const border = new THREE.Mesh(borderGeo, borderMat);
                    
                    const padding = 2;
                    const bottomPadding = 6; // åº•éƒ¨ç•™ç™½
                    border.scale.set(baseWidth + padding*2, baseHeight + padding + bottomPadding, 1);
                    // è¾¹æ¡†ä¸­å¿ƒéœ€è¦ä¸‹ç§»ï¼Œä»¥é€‚åº”åº•éƒ¨ç•™ç™½
                    border.position.y = - (bottomPadding - padding) / 2;

                    // ç»„åˆ
                    const card = new THREE.Group();
                    card.add(border);
                    card.add(photo);

                    // è®¾ç½®æ•´ä½“ä½ç½®
                    card.position.set(...cfg.pos);
                    // å¦‚æœå›¾ç‰‡æ²¡åŠ è½½å‡ºæ¥ï¼Œå¯èƒ½ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥åŠ ä¸ªä¿æŠ¤
                    if (cfg.rot) card.rotation.set(...cfg.rot);

                    // æµ®åŠ¨å‚æ•°
                    card.userData = {
                        originalY: cfg.pos[1],
                        offset: Math.random() * 100
                    };

                    window.photoCards.add(card);
                });
            });
        }

        // --- è¾…åŠ©å·¥å…· ---
        function createEmojiTexture(emoji) {
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.font = '100px Arial'; // å­—ä½“æ”¹å¤§
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, 64, 64);
            return new THREE.CanvasTexture(canvas);
        }

        function createSoftParticleTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createRadialGradient(16,16,0,16,16,16);
            grad.addColorStop(0, 'rgba(255,255,255,1)');
            grad.addColorStop(1, 'rgba(255,255,255,0)');
            ctx.fillStyle = grad;
            ctx.fillRect(0,0,32,32);
            return new THREE.CanvasTexture(canvas);
        }

        // --- åŠ¨ç”»å¾ªç¯ ---
        function animate() {
            requestAnimationFrame(animate);
            const time = performance.now() * 0.001;
            controls.update();

            // è£…é¥°ç‰©æµ®åŠ¨
            if (window.decorations) {
                window.decorations.children.forEach(sprite => {
                    sprite.position.y += Math.sin(time * 2 + sprite.userData.offset) * 0.1;
                });
            }

            // ç…§ç‰‡å¡ç‰‡æµ®åŠ¨ + é¢å‘è§‚ä¼—
            if (window.photoCards) {
                window.photoCards.children.forEach(card => {
                    card.position.y = card.userData.originalY + Math.sin(time + card.userData.offset) * 0.3;
                    card.lookAt(camera.position); // å§‹ç»ˆæœå‘æ‘„åƒæœº
                });
            }

            // æ ‘è‡ªè½¬
            if (particleTree) {
                particleTree.rotation.y = time * 0.05;
                if (window.decorations) window.decorations.rotation.y = time * 0.05;
            }

            composer.render();
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
    </script>
</body>
</html>