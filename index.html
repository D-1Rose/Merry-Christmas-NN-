<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joyful Christmas Tree</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            /* æ¸©é¦¨çš„æ¸å˜èƒŒæ™¯ï¼šä»æ·±çº¢åˆ°åˆå¤œè“ */
            background: radial-gradient(circle at center bottom, #551a2a 0%, #0f0c29 100%);
        }
        
        #ui-container {
            position: absolute; bottom: 20px; width: 100%; text-align: center; 
            pointer-events: none; z-index: 10;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        
        #greeting {
            font-size: 3em; 
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px #ff6600, 0 0 20px #ffcc00;
            pointer-events: auto;
            margin-bottom: 20px;
            animation: bounce 2s infinite ease-in-out;
        }
        
        #slider-container {
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
            display: flex; align-items: center; gap: 10px;
            color: white; font-size: 0.9em;
        }

        input[type=range] {
            width: 200px; cursor: pointer;
        }

        /* ç®€å•çš„è·³åŠ¨åŠ¨ç”» */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-size: 1.5em; pointer-events: none;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/tween.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
</head>
<body>

    <div id="loading">æ­£åœ¨æ‰“åŒ…ç¤¼ç‰©... ğŸ</div>

    <div id="ui-container">
        <div id="greeting" contenteditable="true">Merry Christmas, NN! ğŸ„</div>
        
        <div id="slider-container">
            <span>ğŸ•¯ï¸ æ¸©é¦¨</span>
            <input type="range" id="brightnessSlider" min="0.5" max="3.0" step="0.1" value="1.5">
            <span>âœ¨ é—ªè€€</span>
        </div>
    </div>

    <script>
        // --- 1. é…ç½®åŒºåŸŸ ---
        const imageFiles = ['./1.jpg', './2.jpg', './3.jpg']; // ä½ çš„ç…§ç‰‡
        const EMOJIS = ['ğŸ', 'ğŸ¦Œ', 'ğŸ¬', 'ğŸ””', 'â„ï¸', 'â›„', 'ğŸ„']; // è£…é¥°å…ƒç´ 

        let scene, camera, renderer, composer, controls;
        let particleTree, lights = [];
        let bloomPass;

        function init() {
            // åœºæ™¯
            scene = new THREE.Scene();
            // ä¸è®¾ç½® scene.backgroundï¼Œè®© CSS çš„æ¸å˜èƒŒæ™¯é€å‡ºæ¥ (æˆ–è€…æ··åˆä¸€ç‚¹é›¾)
            scene.fog = new THREE.FogExp2(0x2a0a1a, 0.002); 

            // ç›¸æœº
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 50, 180);

            // æ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); // alpha: true è®©èƒŒæ™¯é€æ˜
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.toneMapping = THREE.ReinhardToneMapping;
            document.body.appendChild(renderer.domElement);

            // æ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.8;
            controls.maxPolarAngle = Math.PI / 2 - 0.1;

            // --- 2. ç¯å…‰ (é«˜äº®æš–è‰²) ---
            const ambientLight = new THREE.AmbientLight(0xffccaa, 0.6); // æš–ç™½ç¯å¢ƒå…‰
            scene.add(ambientLight);

            // æ ¸å¿ƒä¸»å…‰æº (æ ‘ä¸­å¿ƒ)
            const mainLight = new THREE.PointLight(0xffaa00, 1.5, 300);
            mainLight.position.set(0, 80, 0);
            scene.add(mainLight);
            lights.push(mainLight);

            // è¡¥å…‰ (è®©ç…§ç‰‡äº®ä¸€ç‚¹)
            const frontLight = new THREE.DirectionalLight(0xffeecc, 0.8);
            frontLight.position.set(0, 50, 200);
            scene.add(frontLight);
            lights.push(frontLight);

            // --- 3. åœ£è¯æ ‘ (ç²’å­ç‰ˆ) ---
            createFluffyTree();
            
            // --- 4. è£…é¥°å“ (Emoji) ---
            addDecorations();

            // --- 5. ç…§ç‰‡ (ä¸‰è¶³é¼ç«‹) ---
            addFeaturedPhotos();

            // --- 6. åæœŸå¤„ç† (Bloom) ---
            const renderScene = new THREE.RenderPass(scene, camera);
            bloomPass = new THREE.UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight),
                1.2, 0.4, 0.85
            );
            composer = new THREE.EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            // ç§»é™¤ Loading
            document.getElementById('loading').style.display = 'none';
            
            // ç»‘å®šæ»‘å—äº‹ä»¶
            document.getElementById('brightnessSlider').addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                // è°ƒèŠ‚å…‰ç…§å¼ºåº¦
                mainLight.intensity = val;
                frontLight.intensity = val * 0.5;
                // è°ƒèŠ‚è¾‰å…‰å¼ºåº¦
                bloomPass.strength = val * 0.8;
            });

            animate();
        }

        // --- åˆ›å»ºæ¯›èŒ¸èŒ¸çš„ç²’å­æ ‘ ---
        function createFluffyTree() {
            const count = 3000;
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];

            const color1 = new THREE.Color(0x0f5c2e); // æ·±ç»¿
            const color2 = new THREE.Color(0x4dc06b); // å«©ç»¿

            for(let i=0; i<count; i++) {
                const y = Math.random() * 160;
                const progress = 1 - (y / 160);
                // åº•éƒ¨èƒ–ï¼Œé¡¶éƒ¨å°–ï¼Œå¢åŠ ä¸€ç‚¹éšæœºæ‰©æ•£è®©å®ƒè“¬æ¾
                const radius = (10 + progress * 60) + (Math.random() - 0.5) * 10; 
                const angle = Math.random() * Math.PI * 2;

                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                
                positions.push(x, y, z);

                // é¢œè‰²æ··æ‚
                const color = Math.random() > 0.5 ? color1 : color2;
                colors.push(color.r, color.g, color.b);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            // ç”Ÿæˆä¸€ä¸ªæŸ”å’Œçš„åœ†å½¢çº¹ç†
            const spriteMap = createSoftParticleTexture();

            const material = new THREE.PointsMaterial({
                size: 3.5, // å¤§ç²’å­
                map: spriteMap,
                vertexColors: true,
                transparent: true,
                opacity: 0.9,
                depthWrite: false,
                blending: THREE.AdditiveBlending
            });

            particleTree = new THREE.Points(geometry, material);
            scene.add(particleTree);
        }

        // --- æ·»åŠ  Emoji è£…é¥° ---
        function addDecorations() {
            const group = new THREE.Group();
            const count = 300; // è£…é¥°ç‰©æ•°é‡

            for (let i = 0; i < count; i++) {
                // éšæœºé€‰ä¸€ä¸ª Emoji
                const emoji = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];
                const map = createEmojiTexture(emoji);
                const material = new THREE.SpriteMaterial({ map: map, transparent: true });
                const sprite = new THREE.Sprite(material);

                // éšæœºåˆ†å¸ƒåœ¨æ ‘è¡¨é¢
                const y = Math.random() * 150;
                const progress = 1 - (y / 150);
                const radius = (15 + progress * 55); 
                const angle = Math.random() * Math.PI * 2;

                sprite.position.set(
                    Math.cos(angle) * radius,
                    y + 5,
                    Math.sin(angle) * radius
                );
                
                // å¤§å°éšæœº
                const scale = 4 + Math.random() * 3;
                sprite.scale.set(scale, scale, 1);
                
                // ç»™æ¯ä¸ªè£…é¥°ç‰©ä¸€ç‚¹ç‹¬ç«‹çš„æ‘†åŠ¨å‚æ•°
                sprite.userData = {
                    offset: Math.random() * 100,
                    speed: 0.02 + Math.random() * 0.02
                };

                group.add(sprite);
            }
            scene.add(group);
            window.decorations = group;
        }

        // --- æ·»åŠ ä¸‰å¼ ç‰¹å†™ç…§ç‰‡ (éèºæ—‹) ---
        function addFeaturedPhotos() {
            const loader = new THREE.TextureLoader();
            const geometry = new THREE.PlaneGeometry(20, 26); // å¤§å°ºå¯¸
            
            // å®šä¹‰ä¸‰ä¸ªå›ºå®šä½ç½®ï¼š[x, y, z]
            // 1. å·¦å‰æ–¹
            // 2. å³å‰æ–¹
            // 3. é¡¶ç«¯æ­£ä¸­
            const configs = [
                { pos: [-35, 40, 35], rot: [0, Math.PI/4, 0], file: imageFiles[0] },
                { pos: [35, 40, 35], rot: [0, -Math.PI/4, 0], file: imageFiles[1] },
                { pos: [0, 110, 20], rot: [0, 0, 0], file: imageFiles[2] } 
            ];

            const group = new THREE.Group();

            configs.forEach((cfg) => {
                // è¾¹æ¡†æè´¨ (å‘å…‰ç™½)
                const borderMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
                const borderGeo = new THREE.PlaneGeometry(22, 28);
                const border = new THREE.Mesh(borderGeo, borderMat);
                border.position.z = -0.1; // æ”¾åœ¨åé¢ä¸€ç‚¹ç‚¹

                // ç…§ç‰‡æè´¨
                const photoMat = new THREE.MeshBasicMaterial({ side: THREE.DoubleSide });
                const photo = new THREE.Mesh(geometry, photoMat);
                
                // ç»„åˆæˆä¸€ä¸ªæ‹ç«‹å¾—å¯¹è±¡
                const card = new THREE.Group();
                card.add(border);
                card.add(photo);

                card.position.set(...cfg.pos);
                card.rotation.set(...cfg.rot);
                
                // ç¼“æ…¢çš„æ‚¬æµ®åŠ¨ç”»å‚æ•°
                card.userData = {
                    originalY: cfg.pos[1],
                    offset: Math.random() * 100
                };

                loader.load(cfg.file, (tex) => {
                    photoMat.map = tex;
                    photoMat.needsUpdate = true;
                });

                group.add(card);
            });

            scene.add(group);
            window.photoCards = group;
        }

        // --- è¾…åŠ©å·¥å…·ï¼šç”» Emoji è´´å›¾ ---
        function createEmojiTexture(emoji) {
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.font = '100px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, 64, 64);
            const tex = new THREE.CanvasTexture(canvas);
            return tex;
        }

        // --- è¾…åŠ©å·¥å…·ï¼šç”»æŸ”å’Œç²’å­ ---
        function createSoftParticleTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createRadialGradient(16,16,0,16,16,16);
            grad.addColorStop(0, 'rgba(255,255,255,1)');
            grad.addColorStop(1, 'rgba(255,255,255,0)');
            ctx.fillStyle = grad;
            ctx.fillRect(0,0,32,32);
            return new THREE.CanvasTexture(canvas);
        }

        // --- åŠ¨ç”»å¾ªç¯ ---
        function animate() {
            requestAnimationFrame(animate);
            const time = performance.now() * 0.001;
            controls.update();

            // 1. è£…é¥°ç‰©ä¸Šä¸‹æµ®åŠ¨
            if (window.decorations) {
                window.decorations.children.forEach(sprite => {
                    sprite.position.y += Math.sin(time * 2 + sprite.userData.offset) * 0.1;
                });
            }

            // 2. ç…§ç‰‡å¡ç‰‡ç¼“æ…¢æ‚¬æµ® + é¢å‘æ‘„åƒæœºå¾®è°ƒ
            if (window.photoCards) {
                window.photoCards.children.forEach(card => {
                    card.position.y = card.userData.originalY + Math.sin(time + card.userData.offset) * 0.5;
                    // è®©ç…§ç‰‡å§‹ç»ˆæœ‰ä¸€ç‚¹ç‚¹æœå‘è§‚ä¼—ï¼Œä½†ä¿æŒå¤§è‡´ä½ç½®
                    card.lookAt(camera.position);
                });
            }

            // 3. æ ‘æ•´ä½“å¾®æ—‹
            if (particleTree) {
                particleTree.rotation.y = time * 0.05;
                if (window.decorations) window.decorations.rotation.y = time * 0.05;
            }

            composer.render();
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
    </script>
</body>
</html>